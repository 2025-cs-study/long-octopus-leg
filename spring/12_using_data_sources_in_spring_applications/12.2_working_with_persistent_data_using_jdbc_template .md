## 12.2 JdbcTemplateìœ¼ë¡œ ì˜ì†ì„± ë°ì´í„° ì‘ì—…
- ê°€ì¥ ê°„ë‹¨í•œ ë°©ì‹ìœ¼ë¡œ JDBCë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì‘ì—…í•˜ëŠ” ë°©ë²•ì€ `JdbcTemplate` ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ
- ì•„ë˜ ì˜ˆì œ ì½”ë“œë¥¼ ë”°ë¼ ì‹¤ìŠµ

#### ì˜ˆì œ ì½”ë“œ êµ¬í˜„ ë‹¨ê³„
  1. DBMSì— ëŒ€í•œ ì»¤ë„¥ì…˜ì„ ìƒì„±
  2. ë¦¬í¬ì§€í„°ë¦¬ ë¡œì§ì„ ì‘ì„±
  3. REST ì—”ë“œí¬ì¸íŠ¸ì˜ ë™ì‘ì„ êµ¬í˜„í•˜ëŠ” ë©”ì„œë“œì—ì„œ ë¦¬í¬ì§€í„°ë¦¬ ë©”ì„œë“œë¥¼ í˜¸ì¶œ
#### êµ¬ë§¤ í…Œì´ë¸” ì •ë³´
  ```
  - id : í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ì—­í• ì„ í•˜ë©° ìë™ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ê³ ìœ³ê°’
  - product : êµ¬ë§¤í•œ ì œí’ˆ ì´ë¦„
  - price : êµ¬ë§¤ ê°€ê²©
  ```
#### êµ¬í˜„í•  ì•±ì˜ ìš”êµ¬ ì‚¬í•­
  - êµ¬ë§¤ í…Œì´ë¸”ì— ìƒˆ ë ˆì½”ë“œ ì¶”ê°€í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ `POST /purchase`
  - êµ¬ë§¤ í…Œì´ë¸”ì—ì„œ ëª¨ë“  ë ˆì½”ë“œë¥¼ ì¡°íšŒí•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ `GET /purchase`

![img.png](./img/12_2_1.png)

#### ì˜ˆì‹œ ì½”ë“œ
##### build.gradleì— ì˜ì¡´ì„± ì¶”ê°€
```groovy
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
implementation 'org.springframework.boot:spring-boot-starter-web'
runtimeOnly 'com.h2database:h2'
```
##### src/main/resources/schema.sql ì‘ì„±
```sql
CREATE TABLE IF NOT EXISTS purchase (
    id INT AUTO_INCREMENT PRIMARY KEY,
    product varchar(50) NOT NULL,
    price double NOT NULL
);
```
##### êµ¬ë§¤ ëª¨ë¸ í´ë˜ìŠ¤ ì‘ì„±
```java
public class Purchase {

    private int id;
    private String product;
    private BigDecimal price;
    
    // gettersì™€ setters ìƒëµ
```
- ê°€ê²©ì„ doubleì´ ì•„ë‹Œ BigDecimalë¡œ ì„¤ì •í•œ ì´ìœ ëŠ” doubleê³¼ floatê°€ ê°„ë‹¨í•œ ì‚°ìˆ  ì—°ì‚°ì—ì„œë„ ì •ë°€ë„ê°€ ë–¨ì–´ì§€ê¸° ë•Œë¬¸ì— ê°€ê²©ê³¼ ê°™ì€
ë¯¼ê°í•œ ì •ë³´ëŠ” BigDecimalë¥¼ ì‚¬ìš©í•¨. ë³€í™˜ì€ ìŠ¤í”„ë§ì´ ì•Œì•„ì„œ í•´ì¤Œ.

##### PurchaseRepository ë¹ˆ ì •ì˜í•˜ê¸°
```java
@Repository // @Repository ìŠ¤í…Œë ˆì˜¤íƒ€ì… ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì´ í´ë˜ìŠ¤ íƒ€ì…ì˜ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ì— ì¶”ê°€
public class PurchaseRepository {
    
}
```
- PurchaseRepository ë¹ˆì´ ì¶”ê°€ë˜ì–´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì— ì‚¬ìš©í•  JdbcTemplate ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆìŒ.
- ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ì‚¬ìš©ìê°€ H2 ì˜ì¡´ì„±ì„ ì¶”ê°€í•œ ê²ƒì„ ë³´ê³  ë°ì´í„° ì†ŒìŠ¤ì™€ JdbcTemplate ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ êµ¬ì„±í•´ì„œ JdbcTemplate ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì£¼ì… ê°€ëŠ¥

##### ì˜ì†ì„± ë°ì´í„° ì‘ì—…ì„ ìœ„í•œ JdbcTemplate ë¹ˆ ì£¼ì…í•˜ê³  í…Œì´ë¸”ì— ìƒˆë¡œìš´ ë ˆì½”ë“œ ì¶”ê°€í•˜ê¸°
```java
@Repository
public class PurchaseRepository {

  private final JdbcTemplate jdbc;

  public PurchaseRepository(JdbcTemplate jdbc) {
    this.jdbc = jdbc;
  }

  public void storePurchase(Purchase purchase) {
    // ì¿¼ë¦¬ëŠ” ë¬¸ìì—´ë¡œ ì‘ì„±ë˜ë©°, ì¿¼ë¦¬ì˜ ë§¤ê°œë³€ìˆ˜ ê°’ì€ ë¬¼ìŒí‘œë¡œ ëŒ€ì²´ë¨. IDì˜ ê²½ìš° ì´ ì—´ ê°’ì„ ìƒì„±í•˜ë„ë¡ DBMSë¥¼ êµ¬ì„±í•´ì„œ NULLì„ ì‚¬ìš©  
    String sql = "INSERT INTO purchase VALUES (NULL, ?, ?)";
    // update() ë©”ì„œë“œëŠ” ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ë¡œ ë³´ëƒ„. ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ëŠ” ì¿¼ë¦¬ê³  ê·¸ ë‹¤ìŒì€ ë§¤ê°œë³€ìˆ˜ì— ëŒ€í•œ ê°’ì„. ì¿¼ë¦¬ì˜ ê° ë¬¼ìŒí‘œë¥¼ ìˆœì„œëŒ€ë¡œ ëŒ€ì²´í•¨
    jdbc.update(sql, purchase.getProduct(), purchase.getPrice());
  }

}
```
- JdbcTemplateì€ ë°ì´í„° ë³€í˜•ì„ ìœ„í•œ ì¿¼ë¦¬(INSERT, UPDATE, DELETE)ë¥¼ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” update() ë©”ì„œë“œë¥¼ ê°–ê³  ìˆìŒ
- SQLê³¼ í•„ìš”í•œ ë§¤ê°œë³€ìˆ˜ë§Œ ì „ë‹¬í•˜ë©´ ë‚˜ë¨¸ì§€ ì‘ì—…(ì»¤ë„¥ì…˜ íšë“, ì¿¼ë¦¬ë¬¸ ìƒì„±, SQLException ì²˜ë¦¬ ë“±)ì€ JdbcTemplateì´ ì•Œì•„ì„œ ì²˜ë¦¬

##### JdbcTemplateìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë ˆì½”ë“œ ì„ íƒí•˜ê¸°
```java
@Repository
public class PurchaseRepository {

  // ì½”ë“œ ìƒëµ

  public List<Purchase> findAllPurchases() { // ì¡°íšŒí•œ ë ˆì½”ë“œë¥¼ Purchase ê°ì²´ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜
    String sql = "SELECT * FROM purchase";   // SELECT ì¿¼ë¦¬ë¥¼ ì •ì˜í•˜ì—¬ êµ¬ë§¤ í…Œì´ë¸”ì˜ ëª¨ë“  ë ˆì½”ë“œë¥¼ ê°€ì ¸ì˜´

    // ResultSet í–‰ì„ Purchase ê°ì²´ë¡œ ë§¤í•‘í•˜ëŠ” RowMapper êµ¬í˜„
    // ë§¤ê°œë³€ìˆ˜ rì€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ì¸ ResultSetì„, ë§¤ê°œë³€ìˆ˜ iëŠ” í–‰ ë²ˆí˜¸ë¥¼ ë‚˜íƒ€ëƒ„
    RowMapper<Purchase> purchaseRowMapper = (r, i) -> {     
      Purchase rowObject = new Purchase();
      rowObject.setId(r.getInt("id"));
      rowObject.setProduct(r.getString("product"));
      rowObject.setPrice(r.getBigDecimal("price"));
      return rowObject;
    };

    return jdbc.query(sql, purchaseRowMapper);
  }
}
```
- ë°ì´í„°ë¥¼ Purchase ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•ì„ JdbcTemplateì— ì•Œë ¤ì£¼ê³ ì RowMapper(ResultSet í–‰ì„ íŠ¹ì • ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” ê°ì²´) êµ¬í˜„

![img.png](./img/12_2_2.png)

##### ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬í˜„í•˜ê¸°
```java
@RestController
@RequestMapping("/purchase")
public class PurchaseController {

  private final PurchaseRepository purchaseRepository;

  public PurchaseController(PurchaseRepository purchaseRepository) {
    this.purchaseRepository = purchaseRepository;
  }

  @PostMapping
  public void storePurchase(@RequestBody Purchase purchase) {
    purchaseRepository.storePurchase(purchase);
  }

  @GetMapping
  public List<Purchase> findPurchases() {
    return purchaseRepository.findAllPurchases();
  }
}
```
##### ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸í•˜ê¸°
|`POST /purchase`| `GET /purchase`              |
|---|------------------------------|
|![img.png](./img/12_2_3.png)| ![img.png](./img/12_2_4.png) |

### ğŸ™‹ ë©´ì ‘ ì˜ˆìƒ ì§ˆë¬¸
- JdbcTemplateì´ë€ ë¬´ì—‡ì´ê³ , ì–¸ì œ ì‚¬ìš©í•˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- JdbcTemplateì˜ update() ë©”ì„œë“œì™€ query() ë©”ì„œë“œì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- RowMapperê°€ ë¬´ì—‡ì´ê³  ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- ê°€ê²© ë°ì´í„°ë¥¼ double ëŒ€ì‹  BigDecimalë¡œ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.