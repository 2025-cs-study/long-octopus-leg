## 15.2 ìŠ¤í”„ë§ ì•±ì—ì„œ í…ŒìŠ¤íŠ¸ êµ¬í˜„

### ìŠ¤í”„ë§ ì•±ì˜ ì£¼ìš” í…ŒìŠ¤íŠ¸ ê¸°ë²•

- ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ë‘ ê°€ì§€ í•µì‹¬ í…ŒìŠ¤íŠ¸ ë°©ë²•ë¡ ì´ ìˆìŒ.

#### âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Test)
- ë©”ì„œë“œì˜ ë¡œì§ì„ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ì„
- í•œ ê°€ì§€ íë¦„ì—ë§Œ ì§‘ì¤‘í•¨
- ëª¨ë“  ì˜ì¡´ì„±ì„ ì œê±°í•˜ì—¬ ì‘ì€ ë¡œì§ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” ë° ì§‘ì¤‘í•¨

#### âœ… ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸ (Spring Integration Test)
- ë©”ì„œë“œì˜ ë¡œì§ê³¼ í”„ë ˆì„ì›Œí¬ê°€ ì œê³µí•˜ëŠ” íŠ¹ì • ê¸°ëŠ¥ì˜ í†µí•©ì„ ê²€ì¦í•¨
- ì˜ì¡´ì„±ì„ ì—…ê·¸ë ˆì´ë“œí•  ë•Œ ì•± ê¸°ëŠ¥ì´ ì—¬ì „íˆ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŒ

---

### 15.2.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ êµ¬í˜„

#### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ì •ì˜ì™€ ëª©ì 

**ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**ëŠ” ë™ì‘ì„ ê²€ì¦í•˜ë ¤ê³  íŠ¹ì • ì¡°ê±´ì—ì„œ íŠ¹ì • ì‚¬ìš© ì‚¬ë¡€ë¥¼ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œì„. í…ŒìŠ¤íŠ¸í•˜ëŠ” ê¸°ëŠ¥ì˜ ëª¨ë“  ì˜ì¡´ì„±ì„ ì œê±°í•˜ì—¬ ê²©ë¦¬ëœ íŠ¹ì • ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸í•¨.

**ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ì¥ì :**
- íŠ¹ì • ì½”ë“œì— ë¬¸ì œê°€ ìˆë‹¤ëŠ” ê²ƒì„ ëª…í™•íˆ ì‹ë³„í•  ìˆ˜ ìˆìŒ
- ìˆ˜ì •í•´ì•¼ í•  ë¶€ë¶„ì„ ì •í™•íˆ íŒŒì•…í•  ìˆ˜ ìˆìŒ
- ë¡œì§ ë™ì‘ì„ í•˜ë‚˜ì”© ê²€ì¦í•˜ì—¬ íŠ¹ì • ì»´í¬ë„ŒíŠ¸ ë¬¸ì œë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì‹ë³„í•¨

#### ì •ìƒ í”Œë¡œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì‘ì„±
- ì¼ë°˜ì ìœ¼ë¡œ ê°€ì¥ í™•ì‹¤í•œ ì‹œë‚˜ë¦¬ì˜¤ì´ì ê°€ì¥ ë¨¼ì € í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì€ ì˜ˆì™¸ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì‹¤í–‰ ì‹œë‚˜ë¦¬ì˜¤ì¸ **ì •ìƒ í”Œë¡œ**ì„.
##### ê³„ì¢Œ ì´ì²´ ì‚¬ìš© ì‚¬ë¡€ ì˜ˆì œ

```java
@Transactional
public void transferMoney(long idSender, long idReceiver, BigDecimal amount) {
    Account sender = accountRepository.findById(idSender)
            .orElseThrow(() -> new AccountNotFoundException());

    Account receiver = accountRepository.findById(idReceiver)
            .orElseThrow(() -> new AccountNotFoundException());

    BigDecimal senderNewAmount = sender.getAmount().subtract(amount);
    BigDecimal receiverNewAmount = receiver.getAmount().add(amount);

    accountRepository.changeAmount(idSender, senderNewAmount);
    accountRepository.changeAmount(idReceiver, receiverNewAmount);
}

public Iterable<Account> getAllAccounts() {
    return accountRepository.findAll();
}

public List<Account> findAccountsByName(String name) {
    return accountRepository.findAccountsByName(name);
}
```

##### ì½”ë“œ ì‹¤í–‰ ë¡œì§
1. ë°œì‹ ì¸ì˜ ê³„ì¢Œ ì •ë³´ë¥¼ ì°¾ìŒ
2. ìˆ˜ì·¨ì¸ì˜ ê³„ì¢Œ ìƒì„¸ ì •ë³´ë¥¼ ì°¾ìŒ
3. ê° ê³„ì¢Œì— ëŒ€í•œ ìƒˆ ê¸ˆì•¡ì„ ê³„ì‚°í•¨
4. ë°œì‹ ì¸ì˜ ê³„ì¢Œ ê¸ˆì•¡ì„ ì—…ë°ì´íŠ¸í•¨
5. ìˆ˜ì·¨ì¸ì˜ ê³„ì¢Œ ê¸ˆì•¡ì„ ì—…ë°ì´íŠ¸í•¨

#### í…ŒìŠ¤íŠ¸ êµ¬ì¡°ì˜ 3ë‹¨ê³„

- ëª¨ë“  í…ŒìŠ¤íŠ¸ëŠ” **ì„¸ ê°€ì§€ ì£¼ìš” ë¶€ë¶„**ìœ¼ë¡œ êµ¬ì„±ë¨.

![img.png](./img/15_2_1.png)

##### 1. ê°€ì • (Given)
- ì›í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ í”Œë¡œë¥¼ ë‹¬ì„±í•˜ë ¤ë©´ ì…ë ¥ì„ ì •ì˜í•˜ê³  ì œì–´í•´ì•¼ í•  ë¡œì§ì˜ ì˜ì¡´ì„±ì„ ì°¾ì•„ì•¼ í•¨.
  - ì–´ë–¤ ì…ë ¥ì„ ì œê³µí•´ì•¼ í•˜ëŠ”ê°€?
  - í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë¡œì§ì´ ê¸°ëŒ€í•˜ëŠ” íŠ¹ì •í•œ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ë ¤ë©´ ì˜ì¡´ì„±ì´ ì–´ë–»ê²Œ ë™ì‘í•´ì•¼ í•˜ëŠ”ê°€?

##### 2. í˜¸ì¶œ/ì‹¤í–‰ (When)
- í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë¡œì§ì„ í˜¸ì¶œí•˜ì—¬ ë™ì‘ì„ ê²€ì¦í•´ì•¼ í•¨.

##### 3. ìœ íš¨ì„± ê²€ì‚¬ (Then)
- í•´ë‹¹ ë¡œì§ì— ëŒ€í•´ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ëª¨ë“  ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì •ì˜í•´ì•¼ í•¨. í•´ë‹¹ ë¡œì§ì´ ì£¼ì–´ì§„ ì¡°ê±´ì—ì„œ í˜¸ì¶œë˜ë©´ ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ëŠ”ì§€ì— ëŒ€í•œ ì§ˆë¬¸ì— ë‹µí•  ìˆ˜ ìˆì–´ì•¼ í•¨.

#### ì˜ì¡´ì„± ì‹ë³„ê³¼ ëª¨ì˜ ê°ì²´ ì‚¬ìš©

##### ì˜ì¡´ì„±ì˜ ì •ì˜
- ğŸ’  ì˜ì¡´ì„± : ë©”ì„œë“œê°€ ì‚¬ìš©í•˜ì§€ë§Œ ìì²´ì ìœ¼ë¡œ ìƒì„±í•˜ì§€ ì•ŠëŠ” ëª¨ë“  ê²ƒì„ ì˜ë¯¸í•¨
  - ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜
  - ë©”ì„œë“œê°€ ì‚¬ìš©í•˜ì§€ë§Œ ë©”ì„œë“œë¡œ ìƒì„±ë˜ì§€ ì•ŠëŠ” ê°ì²´ ì¸ìŠ¤í„´ìŠ¤

- ê³„ì¢Œ ì´ì²´ ì‚¬ìš© ì‚¬ë¡€ì—ì„œëŠ” `long idSender`, `long idReceiver`, `BigDecimal amount` ë§¤ê°œë³€ìˆ˜ì™€ `accountRepository` ê°ì²´ê°€ ì˜ì¡´ì„±ì„.

##### ëª¨ì˜ ê°ì²´ ì‚¬ìš© ì´ìœ 
- AccountRepositoryì˜ `findById()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” í•œ ë¶€ë¶„ì˜ ë¡œì§ì—ë§Œ ì´ˆì ì„ ë§ì¶”ë¯€ë¡œ ì‹¤ì œ `findById()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œëŠ” ì•ˆ ë¨
- `findById()`ê°€ ì£¼ì–´ì§„ ë°©ì‹ìœ¼ë¡œ ì‘ë™í•œë‹¤ê³  ê°€ì •í•˜ê³  í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë©”ì„œë“œê°€ ì£¼ì–´ì§„ ìƒí™©ì—ì„œ ì˜ˆìƒë˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤ê³  ë‹¨ì–¸(assert)í•¨
- ì‹¤ì œ AccountRepository ê°ì²´ ëŒ€ì‹  ê°€ì§œ ê°ì²´ì¸ ëª¨ì˜(mock) ê°ì²´ë¥¼ ì‚¬ìš©í•¨

![img.png](./img/15_2_2.png)
#### ì •ìƒ í”Œë¡œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ êµ¬í˜„

```java
public class TransferServiceUnitTests {

    @Test
    @DisplayName("Test the amount is transferred from one account to another if no exception occurs.")
    public void moneyTransferHappyFlow() {
        // mock() ë©”ì„œë“œë¡œ AccountRepository ê°ì²´ì— ëŒ€í•œ ëª¨ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•¨
        AccountRepository accountRepository = mock(AccountRepository.class);
        TransferService transferService = new TransferService(accountRepository);

        Account sender = new Account();
        sender.setId(1);
        sender.setAmount(new BigDecimal(1000));

        Account destination = new Account();
        destination.setId(2);
        destination.setAmount(new BigDecimal(1000));
        
        // ëª¨ì˜ ê°ì²´ì˜ ë™ì‘ì„ given()ìœ¼ë¡œ ì œì–´í•¨
        given(accountRepository.findById(sender.getId()))
                .willReturn(Optional.of(sender));

        given(accountRepository.findById(destination.getId()))
                .willReturn(Optional.of(destination));

        transferService.transferMoney(1, 2, new BigDecimal(100));
        
        // í˜¸ì¶œ ê²€ì¦
        verify(accountRepository).changeAmount(1, new BigDecimal(900));
        verify(accountRepository).changeAmount(2, new BigDecimal(1100));
    }
}
```

##### êµ¬í˜„ ì„¤ëª…
- `transferMoney()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë ¤ê³  TransferService ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•¨
- ì‹¤ì œ AccountRepository ì¸ìŠ¤í„´ìŠ¤ ëŒ€ì‹  ì œì–´í•  ìˆ˜ ìˆëŠ” ëª¨ì˜ ê°ì²´ë¥¼ ìƒì„±í•¨
- `mock()` ë©”ì„œë“œëŠ” JUnitê³¼ í•¨ê»˜ ìì£¼ ì‚¬ìš©ë˜ëŠ” Mockito ì˜ì¡´ì„±ì—ì„œ ì œê³µë¨
- `given()` ë©”ì„œë“œë¡œ ëª¨ì˜ ê°ì²´ì˜ ë™ì‘ì„ ì œì–´í•¨
- AccountRepositoryì˜ `findById()` ë©”ì„œë“œê°€ ì£¼ì–´ì§„ ë§¤ê°œë³€ìˆ˜ ê°’ì— ë”°ë¼ íŠ¹ì • Account ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ê²Œ í•¨
- `verify()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ `changeAmount()`ê°€ ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦í•¨

#### ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•œ ëª¨ì˜ ê°ì²´ ìƒì„±

```java
@ExtendWith(MockitoExtension.class) // @Mockê³¼ @InjectMocks ì• ë„ˆí…Œì´ì…˜ì„ í™œì„±í™”í•¨
public class TransferServiceWithAnnotationsUnitTests {

    @Mock // ëª¨ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì˜ ì• ë„ˆí…Œì´ì…˜ëœ í•„ë“œì— ì£¼ì…í•¨
    private AccountRepository accountRepository;

    @InjectMocks // í…ŒìŠ¤íŠ¸í•  ê°ì²´ë¥¼ ìƒì„±í•˜ê³  í´ë˜ìŠ¤ì˜ ì• ë„ˆí…Œì´ì…˜ëœ í•„ë“œì— ì£¼ì…í•¨
    private TransferService transferService;

    @Test
    public void moneyTransferHappyFlow() {
        Account sender = new Account();
        sender.setId(1);
        sender.setAmount(new BigDecimal(1000));

        Account destination = new Account();
        destination.setId(2);
        destination.setAmount(new BigDecimal(1000));

        given(accountRepository.findById(sender.getId()))
                .willReturn(Optional.of(sender));

        given(accountRepository.findById(destination.getId()))
                .willReturn(Optional.of(destination));

        transferService.transferMoney(1, 2, new BigDecimal(100));

        verify(accountRepository).changeAmount(1, new BigDecimal(900));
        verify(accountRepository).changeAmount(2, new BigDecimal(1100));
    }
}
```

##### ì• ë„ˆí…Œì´ì…˜ ì„¤ëª…
- `@Mock`: í”„ë ˆì„ì›Œí¬ê°€ ì• ë„ˆí…Œì´ì…˜ëœ ì†ì„±ì— ëª¨ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì£¼ì…í•¨
- `@InjectMocks`: í…ŒìŠ¤íŠ¸í•  ê°ì²´ë¥¼ ìƒì„±í•˜ê³  í”„ë ˆì„ì›Œí¬ê°€ í•´ë‹¹ ìƒì„±ìì— ëª¨ë“  ëª¨ì˜ ê°ì²´ë¥¼ ì£¼ì…í•˜ë„ë¡ ì§€ì‹œí•¨
- `@ExtendWith(MockitoExtension.class)`: @Mockê³¼ @InjectMocksì´ ì‘ë™í•˜ë ¤ë©´ í•„ìˆ˜ë¡œ ì¶”ê°€í•´ì•¼ í•¨

![img.png](./img/15_2_4.png)
- ìœ„ì˜ ê·¸ë¦¼ìœ¼ë¡œ ê°€ì •, í˜¸ì¶œ, ìœ íš¨ì„± ê²€ì‚¬ ë‹¨ê³„ì™€ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ.

#### ì˜ˆì™¸ í”Œë¡œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì‘ì„±

- ë©”ì„œë“œê°€ ì˜ˆì™¸ë¥¼ ë§Œë‚¬ì„ ë•Œ ê¸°ëŒ€í•œ ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ì§€ë„ í™•ì¸í•´ì•¼ í•˜ë©°, ì´ëŸ° í”Œë¡œë¥¼ **ì˜ˆì™¸ í”Œë¡œ**ë¼ê³  í•¨.
- ê³„ì¢Œ ì´ì²´ ì‚¬ìš© ì‚¬ë¡€ì—ì„œëŠ” ë°œì‹ ì¸ ë˜ëŠ” ìˆ˜ì·¨ì¸ ê³„ì¢Œ ìƒì„¸ ì •ë³´ë¥¼ ì§€ì •ëœ IDë¡œ ì°¾ì„ ìˆ˜ ì—†ì„ ë•Œ ì˜ˆì™¸ í”Œë¡œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ.

```java
@ExtendWith(MockitoExtension.class)
public class TransferServiceWithAnnotationsUnitTests {

    @Mock
    private AccountRepository accountRepository;

    @InjectMocks
    private TransferService transferService;

    @Test
    public void moneyTransferDestinationAccountNotFoundFlow() {
        Account sender = new Account();
        sender.setId(1);
        sender.setAmount(new BigDecimal(1000));

        given(accountRepository.findById(1L))
                .willReturn(Optional.of(sender));

        given(accountRepository.findById(2L))
                .willReturn(Optional.empty());  // ë¹„ì–´ ìˆëŠ” Optionalì„ ë°˜í™˜í•˜ë„ë¡ ì œì–´í•¨

        assertThrows(
                AccountNotFoundException.class, // í•´ë‹¹ ì˜ˆì™¸ ë°œìƒì„ ë‹¨ì–¸(assert)í•¨
                () -> transferService.transferMoney(1, 2, new BigDecimal(100))
        );

        verify(accountRepository, never())      // changeAmount()ê°€ í˜¸ì¶œë˜ì§€ ì•Šì•˜ìŒì„ ë‹¨ì–¸í•¨
                .changeAmount(anyLong(), any());
    }
}
```

- `assertThrows()`: ë©”ì„œë“œê°€ ì˜ˆìƒëœ ì˜ˆì™¸ë¥¼ ë˜ì§€ëŠ”ì§€ ê²€ì¦í•¨
- `never()` ì¡°ê±´: `changeAmount()`ê°€ í˜¸ì¶œë˜ì§€ ì•Šì•˜ìŒì„ í™•ì¸í•¨

#### ë©”ì„œë“œ ë°˜í™˜ê°’ í…ŒìŠ¤íŠ¸

- ë©”ì„œë“œì˜ ë°˜í™˜ê°’ì„ í™•ì¸í•´ì•¼ í•˜ëŠ” ê²½ìš°ì˜ ì˜ˆì œì„.

##### ë¡œê·¸ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ ì˜ˆì œ

```java
@PostMapping()
public String loginPost(
        @RequestParam String username,
        @RequestParam String password,
        Model model) {
    loginProcessor.setUsername(username);
    loginProcessor.setPassword(password);
    boolean loggedIn = loginProcessor.login();
    
    if (loggedIn) {
        model.addAttribute("message", "You are now logged in.");
    } else {
        model.addAttribute("message", "Login Failed!");
    }
    return "login.html";
}
```

##### í…ŒìŠ¤íŠ¸ êµ¬í˜„ ë‹¨ê³„
1. ì˜ì¡´ì„±ì„ ì‹ë³„í•˜ê³  ì œì–´í•¨
2. í…ŒìŠ¤íŠ¸í•  ë©”ì„œë“œë¥¼ í˜¸ì¶œí•¨
3. í…ŒìŠ¤íŠ¸í•  ë©”ì„œë“œ ì‹¤í–‰ì´ ì˜ˆìƒëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•¨

##### ë¡œê·¸ì¸ ì„±ê³µ í…ŒìŠ¤íŠ¸

```java
@ExtendWith(MockitoExtension.class)
class LoginControllerUnitTests {
    @Mock
    private Model model;
    
    @Mock
    private LoginProcessor loginProcessor;
    
    @InjectMocks
    private LoginController loginController;
    
    @Test
    public void loginPostLoginSucceedsTest() {
        given(loginProcessor.login()).willReturn(true);
        
        String result = loginController.loginPost("username", "password", model);
        
        assertEquals("login.html", result);
        
        verify(model).addAttribute("message", "You are now logged in.");
    }
}
```

##### ë¡œê·¸ì¸ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸

```java
@ExtendWith(MockitoExtension.class)
class LoginControllerUnitTests {
    @Mock
    private Model model;
    
    @Mock
    private LoginProcessor loginProcessor;
    
    @InjectMocks
    private LoginController loginController;
    
    @Test
    public void loginPostLoginFailsTest() {
        given(loginProcessor.login()).willReturn(false);
        
        String result = loginController.loginPost("username", "password", model);
        
        assertEquals("login.html", result);
        
        verify(model).addAttribute("message", "Login Failed!");
    }
}
```

- `assertEquals()`: ì˜ˆìƒ ê°’ê³¼ ë©”ì„œë“œê°€ ë°˜í™˜í•˜ëŠ” ê°’ì„ ë¹„êµí•¨
- `verify()`: Model ì¸ìŠ¤í„´ìŠ¤ì˜ `addAttribute()` ë©”ì„œë“œê°€ ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸í•¨

---

### 15.2.2 í†µí•© í…ŒìŠ¤íŠ¸ êµ¬í˜„

#### í†µí•© í…ŒìŠ¤íŠ¸ì˜ íŠ¹ì§•

- í†µí•©í…ŒìŠ¤íŠ¸ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ ë§¤ìš° ìœ ì‚¬í•˜ì§€ë§Œ ì¤‘ìš”í•œ ì°¨ì´ì ì´ ìˆìŒ
  - ê²©ë¦¬ëœ ë¡œì§ì„ í…ŒìŠ¤íŠ¸í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ëª¨ë“  ì˜ì¡´ì„±ì„ ëª¨ì˜í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  í•„ìš”ê°€ ì—†ìŒ
  - ë¦¬í¬ì§€í„°ë¦¬ë¥¼ ëª¨ì˜í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ê°€ ì•„ë‹˜
  - íŠ¹ì • ì»´í¬ë„ŒíŠ¸ì˜ ì‘ë™ ë°©ì‹ë³´ë‹¤ëŠ” ì»´í¬ë„ŒíŠ¸ ë‘ ê°œ ì´ìƒì´ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë°©ì‹ì— ì¤‘ì ì„ ë‘ 

#### í†µí•© í…ŒìŠ¤íŠ¸ì˜ íš¨ê³¼

í†µí•©í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë©´ êµ¬ì„± ìš”ì†Œê°€ ë…ë¦½ì ìœ¼ë¡œ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ì§€ë§Œ ì˜¬ë°”ë¥´ê²Œ í†µì‹ í•˜ì§€ ì•Šì„ ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œë¥¼ ì™„í™”í•˜ëŠ”ë° ë„ì›€ì´ ë¨.

#### í†µí•© í…ŒìŠ¤íŠ¸ ì‚¬ìš© ì‚¬ë¡€
1. ì•± ë‚´ì˜ ê°ì²´ ê°„ í†µí•© : ê°ì²´ê°€ ì˜¬ë°”ë¥´ê²Œ ìƒí˜¸ ì‘ìš©í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•¨.

2. í”„ë ˆì„ì›Œí¬ ê¸°ëŠ¥ê³¼ ì•± ê°ì²´ì˜ í†µí•© : í”„ë ˆì„ì›Œí¬ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ê³¼ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë°©ì‹ì„ í…ŒìŠ¤íŠ¸í•¨.

3. ì•±ê³¼ ì˜ì†ì„± ê³„ì¸µì˜ í†µí•© : ë¦¬í¬ì§€í„°ë¦¬ê°€ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•¨.

#### ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸

- ìŠ¤í”„ë§ ì•±ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•±ì˜ ë™ì‘ì´ ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ê³¼ ì˜¬ë°”ë¥´ê²Œ ìƒí˜¸ ì‘ìš©í•˜ëŠ”ì§€ í™•ì¸í•¨.
- ì´ëŸ° í…ŒìŠ¤íŠ¸ë¥¼ **ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸**ë¼ê³  í•¨.

##### ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸ì˜ íŠ¹ì§•
- ìŠ¤í”„ë§ì´ ì•±ì„ ì‹¤í–‰í•  ë•Œì²˜ëŸ¼ ë¹ˆì„ ìƒì„±í•˜ê³  ì»¨í…ìŠ¤íŠ¸ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ
- `@MockBean` ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ì˜ ê°ì²´ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŒ
- `@MockBean`ì€ `@Mock`ê³¼ ë§¤ìš° ìœ ì‚¬í•˜ì§€ë§Œ, ëª¨ì˜ ê°ì²´ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì— ì¶”ê°€ë¨

#### ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸ êµ¬í˜„ ì˜ˆì œ
![img.png](./img/15_2_5.png)

```java
@SpringBootTest
class TransferServiceSpringIntegrationTests {

    @MockBean // ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ ì¼ë¶€ì´ê¸°ë„ í•œ ëª¨ì˜ ê°ì²´ë¥¼ ìƒì„±í•¨
    private AccountRepository accountRepository;

    @Autowired  // ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•  ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤ì œ ê°ì²´ë¥¼ ì£¼ì…í•¨
    private TransferService transferService;

    @Test
    void transferServiceTransferAmountTest() {
        Account sender = new Account();
        sender.setId(1);
        sender.setAmount(new BigDecimal(1000));

        Account receiver = new Account();
        receiver.setId(2);
        receiver.setAmount(new BigDecimal(1000));

        when(accountRepository.findById(1L)).thenReturn(Optional.of(sender));
        when(accountRepository.findById(2L)).thenReturn(Optional.of(receiver));

        transferService.transferMoney(1, 2, new BigDecimal(100));

        verify(accountRepository).changeAmount(1, new BigDecimal(900));
        verify(accountRepository).changeAmount(2, new BigDecimal(1100));
    }
}
```

#### í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íŠ¹ì§•

- í†µí•©í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰ë¨
- ìŠ¤í”„ë§ì€ í…ŒìŠ¤íŠ¸í•  ê°ì²´ë¥¼ ì¸ì‹í•˜ê³  ì‹¤í–‰ ì¤‘ì¸ ì•±ì²˜ëŸ¼ ê°ì²´ë¥¼ ê´€ë¦¬í•´ì¤Œ
- ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ë¥¼ êµ¬ì„±í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì‹¤í–‰í•˜ëŠ”ë° ë” ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¼

#### í…ŒìŠ¤íŠ¸ ì „ëµ ê¶Œì¥ì‚¬í•­

- íš¨ìœ¨ì ì¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê¶Œì¥ì‚¬í•­
  - **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: ì•± êµ¬ì„± ìš”ì†Œ ë¡œì§ì„ ê²€ì¦í•˜ëŠ”ë° ì‚¬ìš©í•¨
  - **í†µí•© í…ŒìŠ¤íŠ¸**: í”„ë ˆì„ì›Œí¬ì™€ ì–´ë–»ê²Œ í†µí•©ë˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°ë§Œ ì‚¬ìš©í•¨
  - ì´ëŸ¬í•œ ì „ëµì„ ë”°ë¥´ë©´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œê°„ì„ ì ˆì•½í•  ìˆ˜ ìˆìŒ.

### ğŸ™‹ ë©´ì ‘ ì˜ˆìƒ ì§ˆë¬¸
- ë‹¨ìœ„í…ŒìŠ¤íŠ¸ì™€ í†µí•© í…ŒìŠ¤íŠ¸ì˜ ì°¨ì´ì ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- Mock ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- @Mockê³¼ @MockBeanì˜ ì°¨ì´ì ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- Given-When-Then íŒ¨í„´ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- verify() ë©”ì„œë“œì˜ ìš©ë„ì™€ ì‚¬ìš©ë²•ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- assertThrows()ëŠ” ì–¸ì œ ì‚¬ìš©í•˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ì ìš©ëœ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸í•˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œê°„ì„ ë‹¨ì¶•í•˜ëŠ” ë°©ë²•ì€ ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- í…ŒìŠ¤íŠ¸ ì½”ë“œë„ ë¦¬íŒ©í† ë¦¬ì´ì´ í•„ìš”í•œì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.