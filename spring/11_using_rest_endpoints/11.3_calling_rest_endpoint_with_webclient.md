## 11.3 WebClient로 REST 엔드포인트 호출

- 스프링 문서에서는 WebClient 사용을 권장하지만, 이는 리액티브 앱에서만 해당됨.
- 액티브 앱이 아니라면 OpenFeign 사용을 추천함.

![image](https://github.com/user-attachments/assets/d0fbd745-434c-4810-9a19-9ba2b0e38cca)

### 1. `pom.xml`에 WebFlux 의존성 추가

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-webflux</artifactId>
</dependency>
```

### 2. 구성 클래스에서 WebClient 빈 등록

```java
@Configuration
public class ProjectConfig {
  @Bean
  public WebClient webClient(WebClient.Builder builder) {
    return builder.build();
  }
}
```

### 3. 프록시 클래스 정의

```java
@Component
public class PaymentsProxy {
  private final WebClient client;

  @Value("${name.service.url}")
  private String baseUrl;

  public Payment createPayment(Payment payment) {
    return client.post()
      .uri(baseUrl + "/payment")
      .header("requestId", UUID.randomUUID().toString())
      .bodyValue(payment)
      .retrieve()
      .bodyToMono(Payment.class)
      .block();
  }
}
```

### 4. 컨트롤러 정의

```java
@RestController
public class PaymentsController {
  private final PaymentsProxy paymentsProxy;

  @PostMapping("/payment")
  public Payment createPayment(@RequestBody Payment payment) {
    return paymentsProxy.createPayment(payment);
  }
}
```

### cURL 명령

```bash
curl -X POST -H 'content-type:application/json' -d '{"amount":1000}' http://localhost:9090/payment
```

```bash
{
  "id": "e1e6b3c1-ce9c-448e-b7b6-268940ea0fcc",
  "amount": 1000.0
}
```

## ⁉️예상 질문

1. WebClient란 무엇이며, 기존 RestTemplate과의 주요 차이점은 무엇인지 설명해주세요.

&nbsp;

※ 자세한 내용은 [블로그](https://mandusitstudy.tistory.com/442)를 참고해주세요.