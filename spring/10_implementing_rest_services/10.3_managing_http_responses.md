## 10.3 HTTP ì‘ë‹µ ê´€ë¦¬

### HTTP ì‘ë‹µì— í¬í•¨ë˜ëŠ” ë°ì´í„°
- **ì‘ë‹µ í—¤ë”** : ì‘ë‹µì— í¬í•¨ëœ ì‘ì€ ë°ì´í„° ì¡°ê°
- **ì‘ë‹µ ë³¸ë¬¸** : ë°±ì—”ë“œì—ì„œ ì‘ë‹µìœ¼ë¡œ ë³´ë‚´ì•¼ í•˜ëŠ” ë§ì€ ì–‘ì˜ ë°ì´í„°
- **ì‘ë‹µ ìƒíƒœ** : ìš”ì²­ ê²°ê³¼ë¥¼ ê°„ëµí•˜ê²Œ í‘œí˜„í•œ ë‚´ìš©

### 10.3.1 ê°ì²´ë¥¼ ì‘ë‹µ ë³¸ë¬¸ì— ì „ì†¡
- ì‘ë‹µìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ê°ì²´ë¥¼ ë³´ë‚´ë ¤ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì•¡ì…˜ì´ í•´ë‹¹ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê²Œ ë§Œë“¤ë©´ ë¨.
- ğŸ’  **ë°ì´í„° ì „ì†¡ ê°ì²´(Data Transfer Object, DTO)** : ë‘ ì•± ê°„ì— ì „ì†¡ë˜ëŠ” ë°ì´í„°ë¥¼ ëª¨ë¸ë§í•˜ë ¤ê³  ì‚¬ìš©í•˜ëŠ” ê°ì²´
- ì•„ë˜ ì˜ˆì‹œ ì½”ë“œëŠ” Country í´ë˜ìŠ¤ íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ì•¡ì…˜ì„ êµ¬í˜„í•¨.
â¡ï¸ ì•„ë˜ ì˜ˆì‹œì—ì„œ CountryëŠ” DTOë¼ê³  í•  ìˆ˜ ìˆìŒ.
- ğŸ’  **JSON** : ë¬¸ìì—´ì„ ì†ì„±ê³¼ ê°’ì˜ ìŒìœ¼ë¡œ í¬ë§·í•˜ëŠ” ë°©ë²•
  - JSONì€ REST ì—”ë“œí¬ì¸íŠ¸ë¡œ ì‘ì—…í•  ë•Œ ê°ì²´ë¥¼ í‘œí˜„í•˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ ë°©ë²•ì„.
- ì•„ë˜ ì˜ˆì‹œì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ë©´ ìŠ¤í”„ë§ì€ ê°ì²´ì˜ ë¬¸ìì—´ í‘œí˜„ì„ ìƒì„±í•˜ê³  JSON í¬ë§·ìœ¼ë¡œ ë§Œë“¦.
  - `/france` í˜¸ì¶œ
    ```json
    {
      "name" : "France",
      "population" : 67
    }
    ```
  - `/all` í˜¸ì¶œ
    - JSONì—ì„œ ë¦¬ìŠ¤íŠ¸ëŠ” ëŒ€ê´„í˜¸([ ])ë¡œ ì •ì˜í•˜ê³ , ê° ê°ì²´ëŠ” ì¤‘ê´„í˜¸({ })ë¡œ ê°ì‹¸ ì‰¼í‘œ(,)ë¡œ ë¶„ë¦¬í•œë‹¤. 
    ```json
    [
      {
        "name" : "France",
        "population" : 67
      },
      {
        "name" : "Spain",
        "population" : 47
      }
    ]
    ```
- ìŠ¤í”„ë§ì€ ì›í•œë‹¤ë©´ ê°ì²´ì— ëŒ€í•œ ë§ì¶¤í˜• ë³€í™˜ê¸°ë¥¼ ì—°ê²°í•˜ì—¬ ì‘ë‹µ ë³¸ë¬¸ì˜ í˜•ì‹ì„ ì§€ì •í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•(XML, YAML)ë„ ì œê³µí•¨.
```java
public class Country {

    private String name;
    private int population;

    public static Country of(String name, int population) {
        Country country = new Country();
        country.setName(name);
        country.setPopulation(population);
        return country;
    }
  // getters, setters ìƒëµ
}
```
```java
@RestController
public class CountryController {

    @GetMapping("/france")
    public Country france() {
        Country c = Country.of("France", 67);
        return c;
    }

    @GetMapping("/all")
    public List<Country> countries() {
        Country c1 = Country.of("France", 67);
        Country c2 = Country.of("Spain", 47);

        return List.of(c1,c2);
    }
}
```

### 10.3.2 ì‘ë‹µ ìƒíƒœ ë° í—¤ë” ì„¤ì •
- ì‘ë‹µ ìƒíƒœëŠ” ìš”ì²­ ê²°ê³¼ë¥¼ ì•Œë¦¬ëŠ”ë° ì‚¬ìš©í•˜ëŠ” HTTP ì‘ë‹µì˜ í•„ìˆ˜ í”Œë˜ê·¸ì„.
- ìŠ¤í”„ë§ì—ì„œ ìì£¼ ì“°ì´ëŠ” ì‘ë‹µ ìƒíƒœ ì¢…ë¥˜
  - `200 OK` : ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë™ì•ˆ ì„œë²„ ì¸¡ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ ì•Šì€ ê²½ìš°ì— ì‚¬ìš©.
  - `404 Not Found` : ìš”ì²­ëœ ë¦¬ì†ŒìŠ¤ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì— ì‚¬ìš©.
  - `400 Bad Request` : ìš”ì²­ ì¼ë¶€ê°€ ì„œë²„ê°€ ì˜ˆìƒí•œ ë°©ì‹ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì— ì‚¬ìš©.
  - `500 Error on server` : ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë™ì•ˆ ì–´ë–¤ ì´ìœ ë¡œ ì„œë²„ ì¸¡ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²½ìš°ì— ì‚¬ìš©.(ë°±ì—”ë“œì—ì„œ ë¬¸ì œë¥¼ í•´ê²°í•´ì•¼ í•¨.)


- HTTP ì‘ë‹µì„ ì‚¬ìš©ì ì •ì˜í•  ë•Œ ê°€ì¥ ì‰½ê³  ì¼ë°˜ì ì¸ ë°©ë²•ì€ `ResponseEntity` í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ.
  - `ResponseEntityë¥¼` ì‚¬ìš©í•˜ë©´ HTTP ì‘ë‹µ ë³¸ë¬¸, ìƒíƒœ ë° í—¤ë”ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŒ.
- ì•„ë˜ ì˜ˆì‹œëŠ” ResponseEntityë¥¼ ë°˜í™˜í•˜ëŠ” ì˜ˆì‹œ.
  - ì‘ë‹µ ìƒíƒœë¥¼ `202 Accepted`ë¡œ ë³€ê²½í•˜ê³ , í—¤ë” ì„¸ ê°œë¥¼ ì„¤ì •í•¨.
  ```java
  @RestController
  public class CountryController {
  
      @GetMapping("/france")
      public ResponseEntity<Country> france() {
          Country c = Country.of("France", 67);
  
          return ResponseEntity
                  .status(HttpStatus.ACCEPTED)
                  .header("continent", "Europe")
                  .header("capital", "Paris")
                  .header("favorite_food", "cheese and wine")
                  .body(c);
      }
  }
  ```
  ê²°ê³¼ì‚¬ì§„
  ![img.png](img/10_3_1.png)

### 10.3.3 ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì¤€ì—ì„œ ì˜ˆì™¸ ê´€ë¦¬
- ì˜ˆì™¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì—ëŠ” ì•„ë˜ì˜ ë°©ë²•ì´ ìˆìŒ.
  - ResponseEntityë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì™¸ê°€ ë°œìƒí•  ë•Œ ì‘ë‹µì„ ë‹¤ë¥´ê²Œ êµ¬ì„±í•˜ì—¬ ì „ì†¡í•˜ëŠ” ë°©ë²•
  - REST ì»¨íŠ¸ë¡¤ëŸ¬ ì–´ë“œë°”ì´ìŠ¤ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• 
  â¡ï¸ ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œì´ ì˜ˆì™¸ë¥¼ ë˜ì§ˆ ë•Œ ì´ë¥¼ ê°€ë¡œì±„ëŠ” ì• ìŠ¤í™íŠ¸ë¡œ íŠ¹ì • ì˜ˆì™¸ì— ëŒ€í•œ ì‚¬ìš©ì ë¡œì§ì„ ì •ì˜í•¨.

#### 1ï¸âƒ£ ResponseEntityë¡œ ì˜ˆì™¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•
```java
public class ErrorDetails {

    private String message;

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}
```
```java
@RestController
public class PaymentController {

    private final PaymentService paymentService;

    public PaymentController(PaymentService paymentService) {
        this.paymentService = paymentService;
    }

    @PostMapping("/payment")
    public ResponseEntity<?> makePayment() {
        try {
            PaymentDetails paymentDetails = paymentService.processPayment();
            return ResponseEntity
                  .status(HttpStatus.ACCEPTED)
                  .body(paymentDetails);
        } catch (NotEnoughMoneyException e) {
            ErrorDetails errorDetails = new ErrorDetails();
            errorDetails.setMessage("Not enough money to make the payment.");
            return ResponseEntity
                  .badRequest()
                  .body(errorDetails);
        }
    }
}
```
![img.png](img/10_3_2.png)
- ì´ ë°©ë²•ì€ `NotEnoughMoneyException`ë¼ëŠ” ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ë¥¼ ë§Œë“¤ê³ , ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì˜ˆì™¸ë¥¼ ê´€ë¦¬í•´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ResponseEntityë¡œ ErrorDetailsë¥¼ ë°˜í™˜í•˜ê³ ,
ì‘ë‹µ ìƒíƒœë¥¼ `400 Bad Request`ë¡œ ì„¤ì •í•¨.
- ì´ ë°©ë²•ì€ ë§ì´ ì‚¬ìš©ë˜ì§€ë§Œ, ë” ë³µì¡í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì˜ˆì™¸ ê´€ë¦¬ì˜ ì±…ì„ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ë” í¸í•  ìˆ˜ ìˆìŒ.
  - ì—¬ëŸ¬ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•´ ë™ì¼í•œ ì˜ˆì™¸ë¥¼ ê´€ë¦¬í•´ì•¼ í•  ë•Œê°€ ìˆëŠ”ë°, ì½”ë“œì˜ ì¤‘ë³µì„ í”¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸.
  - íŠ¹ì •í•œ ì‚¬ìš© ì‚¬ë¡€ê°€ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ì´í•´í•´ì•¼ í•  ë•Œ ì˜ˆì™¸ ë¡œì§ì„ í•œê³³ì—ì„œ ëª¨ë‘ ì°¾ì„ ìˆ˜ ìˆë‹¤ë©´ ë” í¸ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸.
- ì´ëŸ¬í•œ ì´ìœ  ë•Œë¬¸ì— ì»¨íŠ¸ë¡¤ëŸ¬ ë™ì‘ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ ê°€ë¡œì±„ê³  ê°€ë¡œì±ˆ ì˜ˆì™¸ì— ë”°ë¼ ì‚¬ìš©ì ì •ì˜ ë¡œì§ì„ ì ìš©í•˜ëŠ” **â­ï¸REST ì»¨íŠ¸ë¡¤ëŸ¬ ì–´ë“œë°”ì´ìŠ¤â­ï¸**ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ë„ ë§ì´ ì‚¬ìš©ë¨.

#### 2ï¸âƒ£ REST ì»¨íŠ¸ë¡¤ëŸ¬ ì–´ë“œë°”ì´ìŠ¤ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
```java
@RestController
public class PaymentController {

    private final PaymentService paymentService;

    public PaymentController(PaymentService paymentService) {
        this.paymentService = paymentService;
    }

    @PostMapping("/payment")
    public ResponseEntity<PaymentDetails> makePayment() {
        PaymentDetails paymentDetails = paymentService.processPayment();
        return ResponseEntity
                .status(HttpStatus.ACCEPTED)
                .body(paymentDetails);
    }
}
```
```java
@RestControllerAdvice
public class ExceptionControllerAdvice {

    @ExceptionHandler(NotEnoughMoneyException.class)    // @ExceptionHandler ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì„œë“œê°€
                                                        // êµ¬í˜„í•  ë¡œì§ì„ ì˜ˆì™¸ì™€ ì—°ê²°í•¨.
    public ResponseEntity<ErrorDetails> exceptionNotEnoughMoneyHandler() {
        ErrorDetails errorDetails = new ErrorDetails();
        errorDetails.setMessage("Not enough money to make the payment.");
        return ResponseEntity
            .badRequest()
            .body(errorDetails);
    }
}
```
![img.png](img/10_3_3.png)
- ì´ ë°©ë²•ì€ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ ê´€ë¦¬ë¥¼ í•˜ì§€ ì•Šê³  ê¸°ë³¸ ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤ë§Œ ê´€ë¦¬í•˜ê³ , `ExceptionControllerAdvice` ì»¨íŠ¸ë¡¤ëŸ¬ ì–´ë“œë°”ì´ìŠ¤ë¥¼
ì¶”ê°€í•˜ì—¬ ì»¨íŠ¸ë¡¤ëŸ¬ ì•¡ì…˜ì´ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¬ ë•Œ êµ¬í˜„í•  ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„.
- `ExceptionControllerAdvice`ëŠ” **REST ì»¨íŠ¸ë¡¤ëŸ¬ ì–´ë“œë°”ì´ìŠ¤**ì´ë©°, ì´ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•´ `@RestControllerAdvice` ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•¨.
ì´ í´ë˜ìŠ¤ê°€ ì •ì˜í•˜ëŠ” ë©”ì†Œë“œë¥¼ `ì˜ˆì™¸ í•¸ë“¤ëŸ¬`ë¼ê³ ë„ í•¨.
- ìœ„ì˜ ì½”ë“œëŠ” `NotEnoughMoneyException` ì˜ˆì™¸ì™€ ê´€ë ¨ëœ ë¡œì§ì„ êµ¬í˜„í•˜ëŠ” ì˜ˆì™¸ í•¸ë“¤ëŸ¬ ë©”ì„œë“œë¥¼ ë³´ì—¬ì¤Œ.


### ğŸ™‹ ë©´ì ‘ ì˜ˆìƒ ì§ˆë¬¸
- DTO(Data Transfer Object)ë€ ë¬´ì—‡ì´ê³  ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- ResponseEntityë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì™€ ì¥ì ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- HTTP ì‘ë‹µ ìƒíƒœ ì½”ë“œ 200, 400, 404, 500ì˜ ì˜ë¯¸ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì§ì ‘ ì˜ˆì™¸ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ê³¼ @RestControllerAdviceë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
- ResponseEntity<?> ì—ì„œ ì™€ì¼ë“œì¹´ë“œ(?)ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.