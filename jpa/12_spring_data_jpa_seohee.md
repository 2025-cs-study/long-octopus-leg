# 12. 스프링 데이터 JPA
- 스프링 데이터 JPA는 스프링 프레임워크에서 JPA를 더 쉽고 편리하게 사용할 수 있도록 지원하는 프로젝트임.
- 리포지토리(Repository) 계층의 개발을 크게 단순화하여, 개발자가 CRUD와 같은 반복적인 코드 작성에서 벗어나 비즈니스 로직에 집중할 수 있게 함.

## 12.1 스프링 데이터 JPA 소개
- 스프링 데이터 프로젝트의 하위 프로젝트 중 하나로, JPA를 추상화한 공통 인터페이스(API)를 제공함.
- 간단한 인터페이스 선언만으로 리포지토리 구현 객체를 동적으로 생성하여 스프링 빈으로 등록해줌. ➡️ 데이터 접근 계층을 개발할 때 구현 클래스 없이 인터페이스만 작성해도 개발을 완료할 수 있게 함.

## 12.2 스프링 데이터 JPA 설정
- 스프링 부트에서는 `spring-boot-starter-data-jpa` 의존성 추가만으로 대부분의 설정이 자동으로 완료됨.(책에서는 spring-data-jpa 사용)


## 12.3 공통 인터페이스 기능
- `JpaRepository` 인터페이스를 상속받는 것만으로 `save()`, `findById()`, `findAll()`, `delete()` 등 기본적인 CRUD 기능을 즉시 사용할 수 있음.
- `JpaRepository` 인터페이스 계층 구조 : `Repository` ➡️ `CrudRepository`  ➡️ `PagingAndSortingRepository`  ➡️ `JpaRepository`

## 12.4 쿼리 메소드 기능
- **메소드 이름으로 쿼리 생성**: 정해진 규칙에 따라 리포지토리 인터페이스에 메소드 이름(예: `findByEmailAndName`)을 선언하면, 스프링 데이터 JPA가 메소드 이름을 분석하여 적절한 JPQL 쿼리를 자동으로 생성함.
- **JPA NamedQuery**: 엔티티에 `@NamedQuery`로 정의된 정적 JPQL 쿼리를 `@Query` 어노테이션 없이 메소드 이름만으로 호출할 수 있음 (관례: `엔티티명.메소드명`).
- **@Query, 리파지토리 메소드에 쿼리 정의**: `@Query` 어노테이션을 사용하여 리포지토리 메소드에 직접 JPQL이나 네이티브 SQL을 정의할 수 있음. 복잡한 쿼리나 DTO 조회를 위해 유용함.
- **파라미터 바인딩**: `@Param` 어노테이션을 사용하여 이름 기반으로 파라미터를 바인딩하거나, 위치 기반 바인딩을 사용할 수 있음.
- **벌크성 수정 쿼리**: `@Query`로 작성된 UPDATE, DELETE 쿼리는 `@Modifying` 어노테이션을 함께 사용해야 함. 벌크 연산 후에 영속성 컨텍스트를 초기화하고 싶으면 ➡️ `clearAutomatically = true` 옵션 사용(안전)
- **반환 타입**: 결과가 단건이면 반환 타입 지정, 한 건 이상이면 컬렉션 인터페이스 사용
- **페이징과 정렬**: 메소드의 파라미터로 `Pageable` 또는 `Sort` 객체를 전달하여 동적으로 페이징 및 정렬 조건을 적용할 수 있으며, 반환 타입을 `Page`나 `List`로 설정할 수 있음.
- **힌트(Hint)**: `@QueryHint` 어노테이션을 사용하여 JPA 구현체에게 쿼리 실행에 대한 추가 정보를 제공할 수 있음.
- **Lock**: `@Lock` 어노테이션을 사용하여 쿼리 시 비관적 락을 간편하게 적용할 수 있음.

## 12.5 명세
- JPA Criteria를 기반으로 하여, 쿼리 조건을 객체로 캡슐화하고 동적으로 조합(AND, OR)할 수 있는 기능임.
- `JpaSpecificationExecutor` 인터페이스를 상속받아 사용하며, 복잡한 동적 검색 조건을 구현하는 데 유용함.

## 12.6 사용자 정의 리파지토리 구현
- 스프링 데이터 JPA가 제공하는 공통 기능 외에, 특정 리포지토리에 특화된 커스텀 메소드를 추가해야 할 때 사용함.
- 별도의 인터페이스를 정의하고, '리포지토리 인터페이스 이름 + Impl' 규칙의 구현 클래스를 작성하면 스프링 데이터 JPA가 자동으로 인식하여 통합함.

## 12.7 Web 확장
- 스프링 MVC와 통합되어 웹 레이어에서 리포지토리 기능을 편리하게 사용하도록 지원함.
- **도메인 클래스 컨버터**: 컨트롤러 메소드 파라미터로 엔티티의 ID(PK)를 받으면, 자동으로 해당 엔티티를 조회하여 객체로 바인딩해주는 기능임.
- **페이징과 정렬 기능**: 컨트롤러에서 `Pageable` 객체를 파라미터로 선언하면, HTTP 요청 파라미터(예: `?page=1&size=10&sort=name,desc`)를 분석하여 `Pageable` 객체를 자동으로 생성 및 주입해줌.

## 12.8 스프링 데이터 JPA가 사용하는 구현체
- 개발자가 리포지토리 인터페이스만 정의하면, 스프링 데이터 JPA가 실행 시점에 프록시(Proxy) 기술을 사용하여 `SimpleJpaRepository`를 기반으로 한 구현 클래스를 동적으로 생성함.

## 12.10 스프링 데이터 JPA와 QueryDSL 통합
- 스프링 데이터 JPA는 QueryDSL과 강력하게 통합되어, 타입에 안전한(type-safe) 동적 쿼리를 더욱 편리하게 작성할 수 있음.
- **QueryDslPredicateExecutor**: `Predicate` (QueryDSL의 쿼리 조건)를 파라미터로 받아 실행할 수 있는 간단한 기능을 제공함.
- **QueryDslRepositorySupport**: 사용자 정의 리포지토리에서 `JPAQueryFactory` 대신 이 추상 클래스를 상속받아 QueryDSL을 더 편리하게 사용할 수 있도록 지원함. (단, 최근에는 `JPAQueryFactory`를 직접 빈으로 등록해 사용하는 방식을 더 선호하기도 함)